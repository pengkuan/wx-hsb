{"version":3,"sources":["../app.js"],"names":["App","globalData","cid","bid","pid","cdn","onHide","clearUserInfo","setPartnerInfo","appId","extraData","wx","removeStorage","key","onShow","data","scene","referrerInfo","JSON","parse","login","getWxCode","then","getWxOpenId","code","setWxToken","console","log","openid","setUserInfo","loginRes","err"],"mappings":";;AAAA;;;;AACA;;;;;;AACAA,IAAI;AACFC,cAAY;AACVC,SAAK,CADK;AAEVC,SAAK,CAAC,CAFI;AAGVC,SAAK,IAHK;AAIVC,SAAK;AAJK,GADV;AAOF;AACAC,QARE,oBAQQ;AACR,SAAKC,aAAL;AACA,sBAAQC,cAAR,CAAuB;AACrBC,aAAO,EADc;AAErBC,iBAAW;AAFU,KAAvB;AAID,GAdC;;AAeF;AACAH,eAhBE,2BAgBe;AACfI,OAAGC,aAAH,CAAiB;AACfC,WAAK;AADU,KAAjB;AAGD,GApBC;AAqBFC,QArBE,kBAqBMC,IArBN,EAqBY;AACZ;AACA,QAAGA,KAAKC,KAAL,IAAc,IAAjB,EAAuB;AACrB,UAAIP,QAAQM,KAAKE,YAAL,CAAkBR,KAA9B;AACA,UAAIC,YAAYQ,KAAKC,KAAL,CAAWJ,KAAKE,YAAL,CAAkBP,SAA7B,CAAhB;AACA,wBAAQF,cAAR,CAAuB;AACrBC,oBADqB;AAErBC;AAFqB,OAAvB;AAIA,WAAKT,UAAL,CAAgBG,GAAhB,GAAsBM,UAAUN,GAAhC;AACD;AACD,SAAKgB,KAAL;AACD,GAjCC;AAkCFA,OAlCE,mBAkCO;AACP,mBAAKC,SAAL,GAAiBC,IAAjB,CAAsB,gBAAQ;AAC5B,qBAAKC,WAAL,CAAiBC,IAAjB,EAAuBF,IAAvB,CAA4B,gBAAQ;AAClC;AACA,uBAAKG,UAAL,CAAgBV,IAAhB;AACAW,gBAAQC,GAAR,CAAY,YAAZ,EAA0BZ,IAA1B;AACA,uBAAKK,KAAL,CAAWL,KAAKa,MAAhB,EAAwBN,IAAxB,CAA6B,oBAAY;AACvC;AACA,yBAAKO,WAAL,CAAiBC,QAAjB;AACD,SAHD,EAGG,eAAO;AACR;AACAJ,kBAAQC,GAAR,CAAYI,GAAZ;AACA,yBAAKF,WAAL,CAAiB,EAAjB;AACD,SAPD;AAQD,OAZD;AAaD,KAdD;AAeD;AAlDC,CAAJ","file":"app.js","sourcesContent":["import user from './model/user';\nimport partner from './model/partner';\nApp({\n  globalData: {\n    cid: 1,\n    bid: -1,\n    pid: 1196,\n    cdn: 'http://s1.huishoubao.com/img/phone/'\n  },\n  // 用户切换到后台时 清除登录态\n  onHide () {\n    this.clearUserInfo();\n    partner.setPartnerInfo({\n      appId: '',\n      extraData: {}\n    })\n  },\n  // 清除登录态\n  clearUserInfo () {\n    wx.removeStorage({\n      key: 'userInfo'\n    });\n  },\n  onShow (data) {\n    // 小程序打开小程序\n    if(data.scene == 1037) {\n      let appId = data.referrerInfo.appId;\n      let extraData = JSON.parse(data.referrerInfo.extraData);\n      partner.setPartnerInfo({\n        appId,\n        extraData\n      });\n      this.globalData.pid = extraData.pid;\n    }\n    this.login();\n  },\n  login () {\n    user.getWxCode().then(code => {\n      user.getWxOpenId(code).then(data => {\n        // 保存wx票据 绑定和解绑都有用到\n        user.setWxToken(data);\n        console.log('setWxToken', data);\n        user.login(data.openid).then(loginRes => {\n          // 保存账户的回收宝信息\n          user.setUserInfo(loginRes);\n        }, err => {\n          // C++不支持errCode识别，这里假设错误都是用户没有绑定手机号\n          console.log(err);\n          user.setUserInfo({});\n        })\n      })\n    })\n  },\n});"]}