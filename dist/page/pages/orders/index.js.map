{"version":3,"sources":["../../../../page/pages/orders/index.js"],"names":["ctx","app","getApp","Page","data","orderList","cdn","globalData","num","total","userInfo","hasMore","isShowLoadText","isShowNoMoreText","onShow","wx","setNavigationBarTitle","title","getUserInfo","setData","loadMore","setTimeout","orders","uid","us_uid","userkey","pageIndex","then","res","page_info","order_list","length","concat","refresh","handleCancel","e","showModal","content","success","confirm","dataset","currentTarget","cancelOrder","orderid","olduid","old_uid","showCancel","switchPage","navigateTo","url"],"mappings":";;AAAA;;;;AACA;;;;;;AACA,IAAIA,YAAJ;AAAA,IAASC,MAAMC,QAAf;AACAC,KAAK;;AAEHC,QAAM;AACJC,eAAW,EADP;AAEJC,SAAKL,IAAIM,UAAJ,CAAeD,GAFhB;AAGJE,SAAK,CAHD;AAIJC,WAAO,CAJH;AAKJC,cAAU,EALN;AAMJC,aAAS,IANL;AAOJC,oBAAgB,IAPZ;AAQJC,sBAAkB;AARd,GAFH;;AAaHC,QAbG,oBAaO;AACRd,UAAM,IAAN;AACAe,OAAGC,qBAAH,CAAyB;AACvBC,aAAO;AADgB,KAAzB;AAGA;AACA,QAAIP,WAAW,eAAKQ,WAAL,EAAf;AACAlB,QAAImB,OAAJ,CAAY;AACVP,sBAAgB,IADN;AAEVF;AAFU,KAAZ;AAIAV,QAAIoB,QAAJ;AACD,GAzBE;;;AA2BH;AACAA,UA5BG,sBA4BS;AACV,QAAI,CAACpB,IAAII,IAAJ,CAASO,OAAd,EAAuB;AACrBX,UAAImB,OAAJ,CAAY;AACVN,0BAAkB;AADR,OAAZ;AAGAQ,iBAAW,YAAM;AACfrB,YAAImB,OAAJ,CAAY;AACVN,4BAAkB;AADR,SAAZ;AAGD,OAJD,EAIG,IAJH;AAKD;AACD,QAAIH,WAAWV,IAAII,IAAJ,CAASM,QAAxB;AACA,QAAIF,MAAM,EAAER,IAAII,IAAJ,CAASI,GAArB;AACA,oBAAMc,MAAN,CAAa;AACXC,WAAKb,SAASc,MADH;AAEXC,eAASf,SAASe,OAFP;AAGXC,iBAAWlB;AAHA,KAAb,EAIGmB,IAJH,CAIQ,eAAO;AACb,UAAItB,YAAYL,IAAII,IAAJ,CAASC,SAAzB;AACA,UAAII,QAAQmB,IAAIC,SAAJ,CAAcpB,KAA1B;AACA,UAAIE,UAAUF,QAAQD,GAAtB;AACA,UAAIoB,IAAIE,UAAJ,CAAeC,MAAnB,EAA2B;AACzB1B,oBAAYA,UAAU2B,MAAV,CAAiBJ,IAAIE,UAArB,CAAZ;AACA9B,YAAImB,OAAJ,CAAY;AACVV,sBADU;AAEVE,0BAFU;AAGVN,8BAHU;AAIVO,0BAAgB;AAJN,SAAZ;AAMD;AACF,KAjBD;AAkBD,GA3DE;;;AA6DH;;;;AAIAqB,SAjEG,qBAiEQ;AACTjC,QAAImB,OAAJ,CAAY;AACVX,WAAK,CADK;AAEVH,iBAAW;AAFD,KAAZ;AAIAL,QAAIoB,QAAJ;AACD,GAvEE;;;AAyEH;AACAc,cA1EG,wBA0EWC,CA1EX,EA0Ec;AACfpB,OAAGqB,SAAH,CAAa;AACXnB,aAAO,IADI;AAEXoB,eAAS,UAFE;AAGXC,eAAS,iBAAUV,GAAV,EAAe;AACtB,YAAIA,IAAIW,OAAR,EAAiB;AACf,cAAI7B,WAAWV,IAAII,IAAJ,CAASM,QAAxB;AACA,cAAI8B,UAAUL,EAAEM,aAAF,CAAgBD,OAA9B;AACA,0BAAME,WAAN,CAAkB;AAChBC,qBAASH,QAAQG,OADD;AAEhBpB,iBAAKb,SAASc,MAFE;AAGhBC,qBAASf,SAASe,OAHF;AAIhBmB,oBAAQlC,SAASmC;AAJD,WAAlB,EAKGlB,IALH,CAKQ,eAAO;AACb3B,gBAAIoB,QAAJ;AACD,WAPD,EAOG,eAAO;AACRL,eAAGqB,SAAH,CAAa;AACXnB,qBAAO,IADI;AAEXoB,uBAAS,cAFE;AAGXS,0BAAY;AAHD,aAAb;AAKD,WAbD;AAcD;AACF;AAtBU,KAAb;AAwBD,GAnGE;;;AAqGH;AACAC,YAtGG,sBAsGSZ,CAtGT,EAsGY;AACb,QAAIK,UAAUL,EAAEM,aAAF,CAAgBD,OAA9B;AACAzB,OAAGiC,UAAH,CAAc;AACZC,WAAKT,QAAQS;AADD,KAAd;AAGD;AA3GE,CAAL","file":"index.js","sourcesContent":["import order from '../../../model/order';\nimport user from '../../../model/user';\nlet ctx, app = getApp();\nPage({\n\n  data: {\n    orderList: [],\n    cdn: app.globalData.cdn,\n    num: 0,\n    total: 0,\n    userInfo: {},\n    hasMore: true,\n    isShowLoadText: true,\n    isShowNoMoreText: false\n  },\n\n  onShow () {\n    ctx = this;\n    wx.setNavigationBarTitle({\n      title: '订单中心'\n    });\n    // let userInfo = wx.getStorageSync('userInfo');\n    let userInfo = user.getUserInfo();\n    ctx.setData({\n      isShowLoadText: true,\n      userInfo\n    });\n    ctx.loadMore();\n  },\n\n  // 获取订单列表\n  loadMore () {\n    if (!ctx.data.hasMore) {\n      ctx.setData({\n        isShowNoMoreText: true\n      });\n      setTimeout(() => {\n        ctx.setData({\n          isShowNoMoreText: false\n        });\n      }, 1000)\n    }\n    let userInfo = ctx.data.userInfo;\n    let num = ++ctx.data.num;\n    order.orders({\n      uid: userInfo.us_uid,\n      userkey: userInfo.userkey,\n      pageIndex: num\n    }).then(res => {\n      let orderList = ctx.data.orderList;\n      let total = res.page_info.total;\n      let hasMore = total > num;\n      if (res.order_list.length) {\n        orderList = orderList.concat(res.order_list);\n        ctx.setData({\n          total,\n          hasMore,\n          orderList,\n          isShowLoadText: false\n        });\n      }\n    });\n  },\n\n  /**\n   * 下拉刷新订单列表\n   * 暂时不开启交互不是很好\n   */\n  refresh () {\n    ctx.setData({\n      num: 0,\n      orderList: []\n    });\n    ctx.loadMore();\n  },\n\n  // 取消订单\n  handleCancel (e) {\n    wx.showModal({\n      title: '提示',\n      content: '您真的要取消吗？',\n      success: function (res) {\n        if (res.confirm) {\n          let userInfo = ctx.data.userInfo;\n          let dataset = e.currentTarget.dataset;\n          order.cancelOrder({\n            orderid: dataset.orderid,\n            uid: userInfo.us_uid,\n            userkey: userInfo.userkey,\n            olduid: userInfo.old_uid\n          }).then(res => {\n            ctx.loadMore();\n          }, err => {\n            wx.showModal({\n              title: '提示',\n              content: '取消订单失败，请联系客服',\n              showCancel: false\n            })\n          })\n        }\n      }\n    });\n  },\n\n  // 套页面跳转\n  switchPage (e) {\n    let dataset = e.currentTarget.dataset;\n    wx.navigateTo({\n      url: dataset.url\n    })\n  }\n});"]}