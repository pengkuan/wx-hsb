{"version":3,"sources":["../../../../page/pages/price/index.js"],"names":["Chart","require","ctx","app","getApp","Page","data","desc","price","months","values","selects","productName","productId","isOpen","onLoad","onShow","pages","getCurrentPages","curPage","length","params","options","parseInt","setData","ids","split","classId","priceHistory","then","prices","refreshChart","windowWidth","res","wx","getSystemInfoSync","e","console","error","chart","canvasId","type","categories","animation","legend","dataLabel","series","name","color","format","val","map","item","xAxis","disableGrid","fontColor","yAxis","gridColor","min","width","height","dataPointShape","extra","lineStyle","switchTrade","navigateTo","url","toggleOptions"],"mappings":"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","file":"index.js","sourcesContent":["import product from '../../../model/product';\nconst Chart = require('../../../util/chart');\nlet ctx, app = getApp();\nPage({\n\n  data: {\n    desc: [],\n    price: 0,\n    months: [],\n    values: [],\n    selects: [],\n    productName: '',\n    productId: '',\n    isOpen: false\n  },\n\n  onLoad () {\n    ctx = this;\n  },\n\n  onShow () {\n    let pages = getCurrentPages();\n    let curPage = pages[pages.length - 1];\n    let params = curPage.options;\n    let price = parseInt(params.price) / 100;\n    let productId = params.productId;\n    ctx.setData({\n      price,\n      productId,\n      selects: params.ids,\n      desc: params.desc.split('-'),\n      productName: params.productName,\n      classId: params.classId\n    });\n    product.priceHistory({\n      price,\n      productId\n    }).then(data => {\n      ctx.setData({\n        months: data.months,\n        values: data.prices,\n      });\n      this.refreshChart();\n    })\n  },\n\n  // 价格走势图\n  refreshChart: () => {\n    let windowWidth = 320;\n    try {\n      let res = wx.getSystemInfoSync();\n      windowWidth = res.windowWidth;\n    } catch (e) {\n      console.error('getSystemInfoSync failed!');\n    }\n    let chart = new Chart({\n      canvasId: 'lineCanvas',\n      type: 'line',\n      categories: ctx.data.months,\n      animation: true,\n      legend: false,\n      dataLabel: false,\n      series: [{\n        name: '回收宝价',\n        color: '#fabe00',\n        data: ctx.data.values,\n        format: (val) => parseInt(val) + '元'\n      }, {\n        name: '市场均价',\n        color: '#b967ea',\n        data: ctx.data.values.map((item) => item * 0.8),\n        format: (val) => parseInt(val) + '元'\n      }],\n      xAxis: {\n        disableGrid: true,\n        fontColor: '#cacee0'\n      },\n      yAxis: {\n        fontColor: '#cacee0',\n        gridColor: '#dddddd',\n        format: (val) => parseInt(val),\n        min: ctx.data.values[ctx.data.values.length - 1],\n      },\n      width: windowWidth,\n      height: 200,\n      dataPointShape: true,\n      extra: {\n        lineStyle: 'curve'\n      }\n    });\n  },\n\n  // 跳转到下单页面\n  switchTrade () {\n    let selects = ctx.data.selects;\n    let price = ctx.data.price;\n    let productId = ctx.data.productId;\n    let classId = ctx.data.classId;\n    wx.navigateTo({\n      url: `../trade/index?selects=${selects}&price=${price}&productId=${productId}&classId=${classId}`\n    })\n  },\n\n  toggleOptions () {\n    ctx.setData({\n      isOpen: !ctx.data.isOpen\n    })\n  }\n});"]}