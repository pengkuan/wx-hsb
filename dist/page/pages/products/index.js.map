{"version":3,"sources":["../../../../page/pages/products/index.js"],"names":["ctx","app","getApp","Page","data","cateList","brandList","productList","cid","bid","num","hasMore","brandScrollTop","productScrollTop","left","iconSearch","onLoad","category","then","setData","classlist","onShow","globalData","index","i","length","onCidChanged","cateTapHandler","event","dataSet","currentTarget","dataset","brands","brandlist","undefined","products","productlist","pagenum","brandTapHandler","onBrandIdChanged","loadMoreProduct","oriProd","concat"],"mappings":"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","file":"index.js","sourcesContent":["import product from '../../../model/product';\nlet ctx, app = getApp();\n\nPage({\n\n  data: {\n    cateList: [], // 类目列表\n    brandList: [], // 品牌列表\n    productList: [], // 机型列表\n    cid: 1, // 类目id\n    bid: -1, // 品牌id\n    num: 0,  // 机型分页\n    hasMore: true, //是否具有更多\n    brandScrollTop: 0,\n    productScrollTop: 0,\n    left: 0,\n    iconSearch: '../../../img/icon-search.svg',\n  },\n\n  onLoad() {\n    ctx = this;\n    product.category().then(category => {\n      ctx.setData({\n        cateList: category.classlist\n      });\n    });\n  },\n\n  onShow () {\n    let cid = app.globalData.cid;\n    let bid = app.globalData.bid;\n    let cateList = ctx.data.cateList;\n    let index = 0;\n    for (let i = 0; i < cateList.length; i++) {\n      if (cateList[i]['classid'] == cid) {\n        index = i;\n        break;\n      }\n    }\n    ctx.setData({\n      cid,\n      bid,\n      left: index / cateList.length * 100 + '%'\n    });\n    ctx.onCidChanged(bid);\n  },\n\n  /**\n   * category item Change handler\n   */\n  cateTapHandler(event) {\n    let dataSet = event.currentTarget.dataset;\n    ctx.setData({\n      cid: dataSet.cid,\n      left: (dataSet.index / ctx.data.cateList.length * 100 + '%' )\n    });\n    ctx.onCidChanged();\n  },\n\n  /**\n   * cid change listener\n   * this bid from url\n   */\n  onCidChanged(bid) {\n    product.brands({\n      cid: ctx.data.cid\n    }).then(brands => {\n      ctx.setData({\n        brandList: brands.brandlist,\n        bid: brands.brandlist[0]['brandid'],\n        brandScrollTop: 0\n      });\n      bid !== undefined && ctx.setData({ bid: bid });\n      let num = 1;\n      product.products({\n        cid: ctx.data.cid,\n        bid: ctx.data.bid,\n        num: 1\n      }).then(products => {\n        ctx.setData({\n          productList: products.productlist,\n          hasMore: num < products.pagenum,\n          num,\n          productScrollTop: 0\n        });\n      })\n    })\n  },\n\n  /**\n   * On Brand Change\n   * @param event\n   */\n  brandTapHandler(event) {\n    let dataSet = event.currentTarget.dataset;\n    ctx.setData({\n      bid: dataSet.bid,\n    });\n    ctx.onBrandIdChanged();\n  },\n\n  /**\n   * cid change listener\n   */\n  onBrandIdChanged () {\n    let num = 1;\n    product.products({\n      cid: ctx.data.cid,\n      bid: ctx.data.bid,\n      num: num\n    }).then(products => {\n      ctx.setData({\n        productList: products.productlist,\n        num,\n        hasMore: num < products.pagenum,\n        productScrollTop: 0\n      });\n    })\n  },\n\n  loadMoreProduct () {\n    if(!ctx.data.hasMore) { return }\n    let num = ++ctx.data.num;\n    product.products({\n      cid: ctx.data.cid,\n      bid: ctx.data.bid,\n      num: num\n    }).then(products => {\n      let oriProd = ctx.data.productList;\n      ctx.setData({\n        productList: oriProd.concat(products.productlist),\n        hasMore: num < products.pagenum,\n        num\n      });\n    })\n  },\n});"]}