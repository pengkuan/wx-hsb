{"version":3,"sources":["../../../../page/pages/person/index.js"],"names":["ctx","app","getApp","Page","data","userInfo","wxOpenInfo","grid1Cols","text","path","icon","onLoad","wx","setNavigationBarTitle","title","getWxOpenInfo","then","setData","res","onShow","getUserInfo","tel","us_uid","login","getWxCode","getWxOpenId","code","setWxToken","openid","setUserInfo","loginRes","console","log","err","switchBind","e","dataSet","currentTarget","dataset","navigateTo","url","type","switchPage","showModal","content","showCancel","dialNumber","makePhoneCall","phoneNumber"],"mappings":";;AAAA;;;;;;AACA,IAAIA,YAAJ;AAAA,IAASC,MAAMC,QAAf;;AAEA;;;;;;AAMAC,KAAK;;AAEHC,QAAM;AACJC,cAAU,EADN;AAEJC,gBAAY,EAFR;AAGJC,eAAW,CAAC;AACVC,YAAM,MADI;AAEVC,YAAM,iBAFI;AAGVC,YAAM;AAHI,KAAD,EAIR;AACDF,YAAM,OADL;AAEDC,YAAM,kBAFL;AAGDC,YAAM;AAHL,KAJQ,EAQR;AACDF,YAAM,MADL;AAEDC,YAAM,kBAFL;AAGDC,YAAM;AAHL,KARQ;AAHP,GAFH;;AAoBHC,QApBG,oBAoBO;AACRX,UAAM,IAAN;AACAY,OAAGC,qBAAH,CAAyB;AACvBC,aAAO;AADgB,KAAzB;AAGA,mBAAKC,aAAL,GAAqBC,IAArB,CAA0B,eAAO;AAC/BhB,UAAIiB,OAAJ,CAAY;AACVX,oBAAYY;AADF,OAAZ;AAGD,KAJD;AAKD,GA9BE;AAgCHC,QAhCG,oBAgCM;AACP,QAAId,WAAW,eAAKe,WAAL,EAAf;AACA,QAAI,EAAEf,YAAYA,SAASgB,GAArB,IAA4BhB,SAASiB,MAAvC,CAAJ,EAAoD;AAClDtB,UAAIuB,KAAJ;AACD,KAFD,MAEO;AACLvB,UAAIiB,OAAJ,CAAY;AACVZ;AADU,OAAZ;AAGD;AACF,GAzCE;AA2CHkB,OA3CG,mBA2CM;AACP,mBAAKC,SAAL,GAAiBR,IAAjB,CAAsB,gBAAQ;AAC5B,qBAAKS,WAAL,CAAiBC,IAAjB,EAAuBV,IAAvB,CAA4B,gBAAQ;AAClC;AACA,uBAAKW,UAAL,CAAgBvB,IAAhB;AACA,uBAAKmB,KAAL,CAAWnB,KAAKwB,MAAhB,EAAwBZ,IAAxB,CAA6B,oBAAY;AACvC;AACA,yBAAKa,WAAL,CAAiBC,QAAjB;AACA9B,cAAIiB,OAAJ,CAAY;AACVZ,sBAAUyB;AADA,WAAZ;AAGD,SAND,EAMG,eAAO;AACR;AACAC,kBAAQC,GAAR,CAAYC,GAAZ;AACA,yBAAKJ,WAAL,CAAiB,EAAjB;AACA;AACD,SAXD;AAYD,OAfD;AAgBD,KAjBD;AAkBD,GA9DE;;;AAgEH;AACAK,YAjEG,sBAiESC,CAjET,EAiEY;AACb,QAAIC,UAAUD,EAAEE,aAAF,CAAgBC,OAA9B;AACA1B,OAAG2B,UAAH,CAAc;AACZC,mCAA2BJ,QAAQK;AADvB,KAAd;AAGD,GAtEE;;;AAwEH;AACAC,YAzEG,sBAyESP,CAzET,EAyEY;AACb,QAAIC,UAAUD,EAAEE,aAAF,CAAgBC,OAA9B;AACA,QAAIjC,WAAWL,IAAII,IAAJ,CAASC,QAAxB;AACA,QAAG+B,QAAQI,GAAR,KAAgB,iBAAhB,IAAqCJ,QAAQI,GAAR,KAAgB,kBAAxD,EAA4E;AAC1E,UAAG,CAACnC,SAASgB,GAAb,EAAkB;AAChBT,WAAG+B,SAAH,CAAa;AACX7B,iBAAO,IADI;AAEX8B,mBAAS,SAFE;AAGXC,sBAAY;AAHD,SAAb;AAKD,OAND,MAMO;AACLjC,WAAG2B,UAAH,CAAc;AACZC,eAAKJ,QAAQI;AADD,SAAd;AAGD;AACF,KAZD,MAYO;AACL5B,SAAG2B,UAAH,CAAc;AACZC,aAAKJ,QAAQI;AADD,OAAd;AAGD;AACF,GA7FE;AA+FHM,YA/FG,sBA+FSX,CA/FT,EA+FY;AACbvB,OAAGmC,aAAH,CAAiB;AACfC,mBAAa;AADE,KAAjB;AAGD;AAnGE,CAAL","file":"index.js","sourcesContent":["import user from '../../../model/user';\nlet ctx, app = getApp();\n\n/**\n * 关于 storage userInfo 的使用预定\n * userInfo 为空对象说明用户未绑定手机号\n * userInfo 有key值说明用户已经绑定手机号\n */\n\nPage({\n\n  data: {\n    userInfo: {},\n    wxOpenInfo: {},\n    grid1Cols: [{\n      text: '我的订单',\n      path: '../orders/index',\n      icon: '../../../img/icon-order.png',\n    }, {\n      text: '我的优惠券',\n      path: '../coupons/index',\n      icon: '../../../img/icon-coupon.png',\n    }, {\n      text: '邮寄地址',\n      path: '../address/index',\n      icon: '../../../img/icon-addr.png',\n    }]\n  },\n\n  onLoad () {\n    ctx = this;\n    wx.setNavigationBarTitle({\n      title: '个人中心'\n    });\n    user.getWxOpenInfo().then(res => {\n      ctx.setData({\n        wxOpenInfo: res\n      })\n    });\n  },\n\n  onShow() {\n    let userInfo = user.getUserInfo();\n    if (!(userInfo && userInfo.tel && userInfo.us_uid)) {\n      ctx.login();\n    } else {\n      ctx.setData({\n        userInfo\n      });\n    }\n  },\n\n  login () {\n    user.getWxCode().then(code => {\n      user.getWxOpenId(code).then(data => {\n        // 保存wx票据 绑定和解绑都有用到\n        user.setWxToken(data);\n        user.login(data.openid).then(loginRes => {\n          // 保存账户的回收宝信息\n          user.setUserInfo(loginRes);\n          ctx.setData({\n            userInfo: loginRes\n          });\n        }, err => {\n          // C++不支持errCode识别，这里假设错误都是用户没有绑定手机号\n          console.log(err);\n          user.setUserInfo({});\n          // wx.navigateTo({ url: `../bind/index?openid=${ data.openid }&unionid=${ data.unionid }` })\n        })\n      })\n    })\n  },\n\n  // 绑定解绑手机号\n  switchBind (e) {\n    let dataSet = e.currentTarget.dataset;\n    wx.navigateTo({\n      url: `../bind/index?type=${dataSet.type}`\n    })\n  },\n\n  // 页面跳转\n  switchPage (e) {\n    let dataSet = e.currentTarget.dataset;\n    let userInfo = ctx.data.userInfo;\n    if(dataSet.url === '../orders/index' || dataSet.url === '../coupons/index') {\n      if(!userInfo.tel) {\n        wx.showModal({\n          title: '提示',\n          content: '请先绑定手机号',\n          showCancel: false\n        })\n      } else {\n        wx.navigateTo({\n          url: dataSet.url\n        })\n      }\n    } else {\n      wx.navigateTo({\n        url: dataSet.url\n      })\n    }\n  },\n\n  dialNumber (e) {\n    wx.makePhoneCall({\n      phoneNumber: '4000809966'\n    })\n  }\n});"]}