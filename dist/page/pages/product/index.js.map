{"version":3,"sources":["../../../../page/pages/product/index.js"],"names":["ctx","app","getApp","Page","data","base","func","selects","funcMap","product","pInfo","baseStore","cdn","globalData","baseSelect","funcSelect","len","onLoad","setWhiteNavBar","params","getCurPageOpt","productInfo","productId","then","item","res","itemList","type","forEach","parseInt","conftype","push","setValues","funcHandler","setData","picUrl","picurl","classId","classid","itemid","maxPrice","maxprice","productName","productname","standardPrice","standardprice","list","map","kid","id","did","oid","desc","picture","otext","dtext","ques","question","q","show","name","baseTapHandler","e","dataset","currentTarget","i","length","pid","cid","cname","onSelectsChanged","select","temp","funcTapHandler","console","log","flag","onSubmit","bs","fs","arr","concat","ids","ctext","evaluate","join","wx","navigateTo","url","quotation","showPictures"],"mappings":";;AAAA;;;;AACA;;;;;;AACA,IAAIA,YAAJ;AAAA,IAASC,MAAMC,QAAf;AACAC,KAAK;;AAEHC,QAAM;AACJC,UAAM,EADF;AAEJC,UAAM,EAFF;AAGJC,aAAS,EAHL;AAIJC,aAAS,EAJL;AAKJC,aAAS,EALL;AAMJC,WAAO,EANH;AAOJC,eAAW,EAPP;AAQJC,SAAKX,IAAIY,UAAJ,CAAeD,GARhB;AASJE,gBAAY,EATR;AAUJC,gBAAY,EAVR;AAWJC,SAAK;AAXD,GAFH;;AAgBHC,QAhBG,oBAgBM;AAAA;;AACPjB,UAAM,IAAN;AACA,oBAAMkB,cAAN;AACA,QAAIC,SAAS,gBAAMC,aAAN,EAAb;AACA,sBAAQC,WAAR,CAAoB;AAClBC,iBAAWH,OAAOG;AADA,KAApB,EAEGC,IAFH,CAEQ,eAAO;AACb,UAAIC,OAAOC,IAAIC,QAAf;AACA,UAAIrB,OAAO,EAAX;AAAA,UAAeC,OAAO,EAAtB;AAAA,UAA0BqB,aAA1B;AACAH,WAAKI,OAAL,CAAa,UAACJ,IAAD,EAAU;AACrBG,eAAOE,SAASL,KAAKM,QAAd,CAAP;AACA,YAAIH,SAAS,CAAT,IAAcA,SAAS,CAA3B,EAA8B;AAC5BtB,eAAK0B,IAAL,CAAUP,IAAV;AACD,SAFD,MAEO,IAAIG,SAAS,CAAb,EAAgB;AACrBrB,eAAKyB,IAAL,CAAUP,IAAV;AACD;AACF,OAPD;AAQA,YAAKQ,SAAL,CAAe3B,IAAf,EAAqB,MAArB;AACA,YAAK2B,SAAL,CAAe1B,IAAf,EAAqB,MAArB;AACAA,aAAON,IAAIiC,WAAJ,CAAgB3B,IAAhB,CAAP;AACAN,UAAIkC,OAAJ,CAAY;AACV7B,kBADU;AAEVC,kBAFU;AAGVI,eAAO;AACLyB,kBAAQV,IAAIW,MADP;AAELC,mBAASZ,IAAIa,OAFR;AAGLhB,qBAAWG,IAAIc,MAHV;AAILC,oBAAUf,IAAIgB,QAJT;AAKLC,uBAAajB,IAAIkB,WALZ;AAMLC,yBAAenB,IAAIoB;AANd;AAHG,OAAZ;AAYD,KA5BD;AA6BD,GAjDE;;;AAmDH;;;;;AAKAZ,aAxDG,uBAwDSa,IAxDT,EAwDe;AAChB,QAAIxC,OAAO,EAAX;AACAwC,SAAKC,GAAL,CAAS,UAACvB,IAAD,EAAU;AACjB,UAAIwB,MAAMxB,KAAKyB,EAAf;AAAA,UAAmBC,YAAnB;AAAA,UAAwBC,YAAxB;AAAA,UAA6BC,aAA7B;AAAA,UAAmCC,gBAAnC;AAAA,UAA4CC,cAA5C;AAAA,UAAmDC,cAAnD;AACA,UAAIC,OAAOhC,KAAKiC,QAAhB;AACAD,WAAKT,GAAL,CAAS,UAACW,CAAD,EAAO;AACd,YAAIA,EAAEC,IAAF,IAAU,CAAd,EAAiB;AACfT,gBAAMQ,EAAET,EAAR;AACAM,kBAAQG,EAAEE,IAAV;AACD,SAHD,MAGO;AACLT,gBAAMO,EAAET,EAAR;AACAG,iBAAOM,EAAEE,IAAT;AACAP,oBAAUK,EAAEL,OAAZ;AACAC,kBAAQI,EAAEE,IAAV;AACD;AACF,OAVD;AAWAtD,WAAKyB,IAAL,CAAU,EAACiB,QAAD,EAAME,QAAN,EAAWC,QAAX,EAAgBC,UAAhB,EAAsBC,gBAAtB,EAA+BC,YAA/B,EAAsCC,YAAtC,EAAV;AACD,KAfD;AAgBA,WAAOjD,IAAP;AACD,GA3EE;;;AA6EH;;;;AAIAuD,gBAjFG,0BAiFaC,CAjFb,EAiFgB;AACjB,QAAIC,UAAUD,EAAEE,aAAF,CAAgBD,OAA9B;AACA,QAAIjD,aAAad,IAAII,IAAJ,CAASU,UAA1B;AACA,SAAK,IAAImD,IAAI,CAAb,EAAgBA,IAAInD,WAAWoD,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,UAAInD,WAAWmD,CAAX,EAAc,KAAd,MAAyBF,QAAQI,GAArC,EAA0C;AACxCrD,mBAAWmD,CAAX,EAAc,KAAd,IAAuBF,QAAQK,GAA/B;AACAtD,mBAAWmD,CAAX,EAAc,OAAd,IAAyBF,QAAQM,KAAjC;AACD;AACF;AACDrE,QAAIkC,OAAJ,CAAY;AACVpB;AADU,KAAZ;AAGAd,QAAIsE,gBAAJ;AACD,GA9FE;AAgGHtC,WAhGG,qBAgGQ5B,IAhGR,EAgG6B;AAAA,QAAfuB,IAAe,uEAAR,MAAQ;;AAC9B,QAAI4C,SAAS,EAAb;AACAnE,SAAK2C,GAAL,CAAS,UAACvB,IAAD,EAAU;AACjB,UAAIgD,OAAO,EAAX;AACAA,WAAK,KAAL,IAAchD,KAAKyB,EAAnB;AACAuB,WAAK,OAAL,IAAgBhD,KAAKoC,IAArB;AACAY,WAAK,KAAL,IAAc,EAAd;AACAA,WAAK,OAAL,IAAgB,EAAhB;AACA,UAAIhD,KAAKM,QAAL,IAAiB,CAArB,EAAwB;AACtBN,aAAKiC,QAAL,CAAcV,GAAd,CAAkB,UAACS,IAAD,EAAU;AAC1B,cAAIA,KAAK,MAAL,KAAgB,CAApB,EAAuB;AACrBgB,iBAAK,KAAL,IAAchB,KAAKP,EAAnB;AACAuB,iBAAK,OAAL,IAAgBhB,KAAKI,IAArB;AACD;AACF,SALD;AAMD;AACDW,aAAOxC,IAAP,CAAYyC,IAAZ;AACD,KAfD;AAgBA,QAAI7C,QAAQ,MAAZ,EAAoB3B,IAAIkC,OAAJ,CAAY,EAACpB,YAAYyD,MAAb,EAAZ;AACpB,QAAI5C,QAAQ,MAAZ,EAAoB3B,IAAIkC,OAAJ,CAAY,EAACnB,YAAYwD,MAAb,EAAZ;AACpBvE,QAAIsE,gBAAJ;AACD,GArHE;;;AAuHH;;;;AAIAG,gBA3HG,0BA2HaX,CA3Hb,EA2HgB;AACjB,QAAIC,UAAUD,EAAEE,aAAF,CAAgBD,OAA9B;AACA,QAAIhD,aAAaf,IAAII,IAAJ,CAASW,UAA1B;AACA2D,YAAQC,GAAR,CAAYZ,OAAZ;AACA,SAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIlD,WAAWmD,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,UAAIlD,WAAWkD,CAAX,EAAc,KAAd,KAAwBF,QAAQf,GAApC,EAAyC;AACvC,YAAI4B,OAAO7D,WAAWkD,CAAX,EAAc,KAAd,CAAX;AACA,YAAIW,QAAQb,QAAQZ,GAApB,EAAyB;AACvBpC,qBAAWkD,CAAX,EAAc,KAAd,IAAuBF,QAAQb,GAA/B;AACAnC,qBAAWkD,CAAX,EAAc,OAAd,IAAyBF,QAAQR,KAAjC;AACD,SAHD,MAGO;AACLxC,qBAAWkD,CAAX,EAAc,KAAd,IAAuBF,QAAQZ,GAA/B;AACApC,qBAAWkD,CAAX,EAAc,OAAd,IAAyBF,QAAQT,KAAjC;AACD;AACF;AACF;AACDtD,QAAIkC,OAAJ,CAAY;AACVnB;AADU,KAAZ;AAGAf,QAAIsE,gBAAJ;AACD,GA/IE;;;AAiJH;;;;AAIAA,kBArJG,8BAqJiB;AAClB,QAAItD,MAAM,CAAV;AAAA,QACEF,aAAad,IAAII,IAAJ,CAASU,UADxB;AAEA,SAAK,IAAImD,IAAI,CAAb,EAAgBA,IAAInD,WAAWoD,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,UAAInD,WAAWmD,CAAX,EAAc,KAAd,EAAqBC,MAAzB,EAAiClD;AAClC;AACDhB,QAAIkC,OAAJ,CAAY;AACVlB;AADU,KAAZ;AAGD,GA9JE;;;AAgKH;;;AAGA6D,UAnKG,sBAmKS;AACV,QAAInE,QAAQV,IAAII,IAAJ,CAASM,KAArB;AACA,QAAIoE,KAAK9E,IAAII,IAAJ,CAASU,UAAlB;AACA,QAAIiE,KAAK/E,IAAII,IAAJ,CAASW,UAAlB;AACA,QAAIiE,MAAMF,GAAGG,MAAH,CAAUF,EAAV,CAAV;AACA,QAAIG,MAAMF,IAAIjC,GAAJ,CAAQ;AAAA,aAAQvB,KAAK4C,GAAb;AAAA,KAAR,CAAV;AACA,QAAIhB,OAAO4B,IAAIjC,GAAJ,CAAQ;AAAA,aAAQvB,KAAK2D,KAAb;AAAA,KAAR,CAAX;AACA,sBAAQC,QAAR,CAAiB;AACf9D,iBAAWtB,IAAII,IAAJ,CAASM,KAAT,CAAeY,SADX;AAEff,eAAS2E,IAAIG,IAAJ,CAAS,GAAT;AAFM,KAAjB,EAGG9D,IAHH,CAGQ,gBAAQ;AACd+D,SAAGC,UAAH,CAAc;AACZC,uCAA6BpF,KAAKqF,SAAlC,aAAmDP,IAAIG,IAAJ,CAAS,GAAT,CAAnD,cAAyEjC,KAAKiC,IAAL,CAAU,GAAV,CAAzE,mBAAqG3E,MAAMY,SAA3G,qBAAoIZ,MAAMgC,WAA1I,iBAAiKhC,MAAM2B;AAD3J,OAAd;AAGD,KAPD,EAOG,eAAO;AACRqC,cAAQC,GAAR,CAAYlD,GAAZ;AACD,KATD;AAUD,GApLE;AAsLHiE,cAtLG,wBAsLW5B,CAtLX,EAsLc;AACfY,YAAQC,GAAR,CAAYb,CAAZ;AACD;AAxLE,CAAL","file":"index.js","sourcesContent":["import Utils from '../../../util/utils';\nimport product from '../../../model/product';\nlet ctx, app = getApp();\nPage({\n\n  data: {\n    base: [],\n    func: [],\n    selects: {},\n    funcMap: {},\n    product: {},\n    pInfo: {},\n    baseStore: [],\n    cdn: app.globalData.cdn,\n    baseSelect: [],\n    funcSelect: [],\n    len: 0\n  },\n\n  onLoad() {\n    ctx = this;\n    Utils.setWhiteNavBar();\n    let params = Utils.getCurPageOpt();\n    product.productInfo({\n      productId: params.productId\n    }).then(res => {\n      let item = res.itemList;\n      let base = [], func = [], type;\n      item.forEach((item) => {\n        type = parseInt(item.conftype);\n        if (type === 1 || type === 2) {\n          base.push(item)\n        } else if (type === 3) {\n          func.push(item);\n        }\n      });\n      this.setValues(base, 'base');\n      this.setValues(func, 'func');\n      func = ctx.funcHandler(func);\n      ctx.setData({\n        base,\n        func,\n        pInfo: {\n          picUrl: res.picurl,\n          classId: res.classid,\n          productId: res.itemid,\n          maxPrice: res.maxprice,\n          productName: res.productname,\n          standardPrice: res.standardprice\n        }\n      });\n    })\n  },\n\n  /**\n   * 生成功能选项对应的数据结构\n   * 功能选项本质是一个具有默认值和可选值的单选框\n   * @param {*} list\n   */\n  funcHandler(list) {\n    let func = [];\n    list.map((item) => {\n      let kid = item.id, did, oid, desc, picture, otext, dtext;\n      let ques = item.question;\n      ques.map((q) => {\n        if (q.show == 0) {\n          did = q.id;\n          dtext = q.name;\n        } else {\n          oid = q.id;\n          desc = q.name;\n          picture = q.picture;\n          otext = q.name;\n        }\n      });\n      func.push({kid, did, oid, desc, picture, otext, dtext})\n    });\n    return func;\n  },\n\n  /**\n   * 基本选项 外观选项 切换\n   * @param {*} e\n   */\n  baseTapHandler (e) {\n    let dataset = e.currentTarget.dataset;\n    let baseSelect = ctx.data.baseSelect;\n    for (let i = 0; i < baseSelect.length; i++) {\n      if (baseSelect[i]['pid'] === dataset.pid) {\n        baseSelect[i]['cid'] = dataset.cid;\n        baseSelect[i]['ctext'] = dataset.cname;\n      }\n    }\n    ctx.setData({\n      baseSelect\n    });\n    ctx.onSelectsChanged();\n  },\n\n  setValues (data, type = 'base') {\n    let select = [];\n    data.map((item) => {\n      let temp = {};\n      temp['pid'] = item.id;\n      temp['ptext'] = item.name;\n      temp['cid'] = \"\";\n      temp['ctext'] = \"\";\n      if (item.conftype == 3) {\n        item.question.map((ques) => {\n          if (ques['show'] == 0) {\n            temp['cid'] = ques.id;\n            temp['ctext'] = ques.name;\n          }\n        })\n      }\n      select.push(temp);\n    });\n    if (type == 'base') ctx.setData({baseSelect: select});\n    if (type == 'func') ctx.setData({funcSelect: select});\n    ctx.onSelectsChanged();\n  },\n\n  /**\n   * 功能选项切换\n   * @param {*} e\n   */\n  funcTapHandler (e) {\n    let dataset = e.currentTarget.dataset;\n    let funcSelect = ctx.data.funcSelect;\n    console.log(dataset);\n    for (let i = 0; i < funcSelect.length; i++) {\n      if (funcSelect[i]['pid'] == dataset.kid) {\n        let flag = funcSelect[i]['cid'];\n        if (flag == dataset.oid) {\n          funcSelect[i]['cid'] = dataset.did;\n          funcSelect[i]['ctext'] = dataset.dtext;\n        } else {\n          funcSelect[i]['cid'] = dataset.oid;\n          funcSelect[i]['ctext'] = dataset.otext;\n        }\n      }\n    }\n    ctx.setData({\n      funcSelect\n    });\n    ctx.onSelectsChanged();\n  },\n\n  /**\n   * 监听 selects 做一些猥琐的操作\n   * 改变进度条 限制一些选项等等...\n   */\n  onSelectsChanged () {\n    let len = 0,\n      baseSelect = ctx.data.baseSelect;\n    for (let i = 0; i < baseSelect.length; i++) {\n      if (baseSelect[i]['cid'].length) len++;\n    }\n    ctx.setData({\n      len\n    })\n  },\n\n  /**\n   * 估价\n   */\n  onSubmit () {\n    let pInfo = ctx.data.pInfo;\n    let bs = ctx.data.baseSelect;\n    let fs = ctx.data.funcSelect;\n    let arr = bs.concat(fs);\n    let ids = arr.map(item => item.cid);\n    let desc = arr.map(item => item.ctext);\n    product.evaluate({\n      productId: ctx.data.pInfo.productId,\n      selects: ids.join('-')\n    }).then(data => {\n      wx.navigateTo({\n        url: `../price/index?price=${data.quotation}&ids=${ids.join('-')}&desc=${desc.join('-')}&productId=${pInfo.productId}&productName=${pInfo.productName}&classId=${pInfo.classId}`\n      })\n    }, res => {\n      console.log(res);\n    })\n  },\n\n  showPictures (e) {\n    console.log(e);\n  }\n});"]}