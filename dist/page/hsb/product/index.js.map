{"version":3,"sources":["../../../../page/hsb/product/index.js"],"names":["ctx","Page","data","cateList","brandList","productList","cid","bid","undefined","num","hasMore","brandScrollTop","productScrollTop","onLoad","params","category","then","setData","classlist","onCidChanged","cateTapHandler","event","dataSet","currentTarget","dataset","brands","brandlist","products","productlist","pagenum","brandTapHandler","onBrandIdChanged","onProductNumChanged","refreshProduct","console","log","loadMoreProduct","oriProd","concat","upper","e","lower","scroll","scrollToTop","setAction","scrollTop","tap","i","order","length","toView","tapMove"],"mappings":"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","file":"index.js","sourcesContent":["import product from '../../../model/product';\nlet ctx;\nPage({\n  data: {\n    cateList: [], // 类目列表\n    brandList: [], // 品牌列表\n    productList: [], // 机型列表\n    cid: 1, // 类目id\n    bid: undefined, // 品牌id\n    num: 0,  // 机型分页\n    hasMore: true, //是否具有更多\n    brandScrollTop: 0,\n    productScrollTop: 0\n  },\n  onLoad(params) {\n    ctx = this;\n    product.category().then(category => {\n      ctx.setData({\n        cateList: category.classlist,\n        cid: category.classlist[0]['classid']\n      });\n      if (params.cid) ctx.setData({cid: params.cid});\n      ctx.onCidChanged(params.bid);\n    });\n  },\n\n  /**\n   * category item Change handler\n   */\n  cateTapHandler(event) {\n    let dataSet = event.currentTarget.dataset;\n    ctx.setData({cid: dataSet.cid});\n    ctx.onCidChanged();\n  },\n\n  /**\n   * cid change listener\n   * this bid from url\n   */\n  onCidChanged(bid) {\n    product.brands({\n      cid: ctx.data.cid\n    }).then(brands => {\n      ctx.setData({\n        brandList: brands.brandlist,\n        bid: brands.brandlist[0]['brandid'],\n        brandScrollTop: 0\n      });\n      bid !== undefined && ctx.setData({ bid: bid });\n      let num = 1;\n      product.products({\n        cid: ctx.data.cid,\n        bid: ctx.data.bid,\n        num: 1\n      }).then(products => {\n        ctx.setData({\n          productList: products.productlist,\n          hasMore: num < products.pagenum,\n          num,\n          productScrollTop: 0\n        });\n      })\n    })\n  },\n\n  /**\n   * On Brand Change\n   * @param event\n   */\n  brandTapHandler(event) {\n    let dataSet = event.currentTarget.dataset;\n    ctx.setData({\n      bid: dataSet.bid,\n    });\n    ctx.onBrandIdChanged();\n  },\n\n  /**\n   * cid change listener\n   */\n  onBrandIdChanged () {\n    let num = 1;\n    product.products({\n      cid: ctx.data.cid,\n      bid: ctx.data.bid,\n      num: num\n    }).then(products => {\n      ctx.setData({\n        productList: products.productlist,\n        num,\n        hasMore: num < products.pagenum,\n        productScrollTop: 0\n      });\n    })\n  },\n\n  onProductNumChanged () {\n\n  },\n\n  refreshProduct () {\n    console.log('upper');\n  },\n  loadMoreProduct () {\n    if(!ctx.data.hasMore) { return }\n    let num = ++ctx.data.num;\n    product.products({\n      cid: ctx.data.cid,\n      bid: ctx.data.bid,\n      num: num\n    }).then(products => {\n      let oriProd = ctx.data.productList;\n      ctx.setData({\n        productList: oriProd.concat(products.productlist),\n        hasMore: num < products.pagenum,\n        num\n      });\n    })\n  },\n  upper: function (e) {\n    console.log(e)\n  },\n  lower: function (e) {\n    console.log(e)\n  },\n  scroll: function (e) {\n    console.log(e)\n  },\n  scrollToTop: function (e) {\n    this.setAction({\n      scrollTop: 0\n    })\n  },\n  tap: function (e) {\n    for (let i = 0; i < order.length; ++i) {\n      if (order[i] === this.data.toView) {\n        this.setData({\n          toView: order[i + 1],\n          scrollTop: (i + 1) * 200\n        });\n        break\n      }\n    }\n  },\n  tapMove: function (e) {\n    this.setData({\n      scrollTop: this.data.scrollTop + 10\n    })\n  }\n});"]}