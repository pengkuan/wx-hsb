{"version":3,"sources":["../../../../page/hsb/bind/index.js"],"names":["ctx","Page","data","tel","code","openid","unionid","onLoad","params","wx","setNavigationBarTitle","title","setData","getCode","console","log","then","showInfo","icon","retcode","retinfo","showToast","telHandler","e","value","detail","codeHandler","submit","bindTelLogin","res","setStorage","key","userinfo","success","navigateBack","err"],"mappings":";;AAAA;;;;;;AACA,IAAIA,YAAJ;AACAC,KAAK;;AAEHC,QAAM;AACJC,SAAK,EADD;AAEJC,UAAM,EAFF;AAGJC,YAAQ,EAHJ;AAIJC,aAAS;AAJL,GAFH;;AASHC,QATG,kBASKC,MATL,EASa;AACdR,UAAM,IAAN;AACAS,OAAGC,qBAAH,CAAyB,EAACC,OAAO,OAAR,EAAzB;AACAX,QAAIY,OAAJ,CAAY;AACVP,cAAQG,OAAOH,MADL;AAEVC,eAASE,OAAOF;AAFN,KAAZ;AAID,GAhBE;;;AAkBH;AACAO,SAnBG,qBAmBQ;AACT,QAAIV,MAAMH,IAAIE,IAAJ,CAASC,GAAnB;AACAW,YAAQC,GAAR,CAAYZ,GAAZ;AACA,mBAAKU,OAAL,CAAa,EAAEV,QAAF,EAAb,EAAsBa,IAAtB,CAA2B,gBAAQ;AACjC,UAAIC,WAAW;AACbN,eAAO,IADM;AAEbO,cAAM;AAFO,OAAf;AAIA,UAAIhB,KAAKiB,OAAL,IAAgB,CAApB,EAAuB;AACrBF,iBAASN,KAAT,GAAiB,QAAjB;AACAM,iBAASC,IAAT,GAAgB,SAAhB;AACD,OAHD,MAGO;AACLD,iBAASN,KAAT,GAAiBT,KAAKkB,OAAtB;AACD;AACDX,SAAGY,SAAH,CAAaJ,QAAb;AACD,KAZD;AAaD,GAnCE;AAqCHK,YArCG,sBAqCSC,CArCT,EAqCY;AACb,QAAIC,QAAQD,EAAEE,MAAF,CAASD,KAArB;AACA,SAAKZ,OAAL,CAAa,EAAET,KAAKqB,KAAP,EAAb;AACD,GAxCE;AA0CHE,aA1CG,uBA0CUH,CA1CV,EA0Ca;AACd,QAAIC,QAAQD,EAAEE,MAAF,CAASD,KAArB;AACA,SAAKZ,OAAL,CAAa,EAAER,MAAMoB,KAAR,EAAb;AACD,GA7CE;AA+CHG,QA/CG,oBA+CO;AACR,QAAIzB,OAAOF,IAAIE,IAAf;AACAY,YAAQC,GAAR,CAAYb,IAAZ;AACA,mBAAK0B,YAAL,CAAkB;AAChBzB,WAAKD,KAAKC,GADM;AAEhBC,YAAMF,KAAKE,IAFK;AAGhBC,cAAQH,KAAKG,MAHG;AAIhBC,eAASJ,KAAKI;AAJE,KAAlB,EAKGU,IALH,CAKQ,eAAO;AACb,UAAGa,IAAIV,OAAJ,IAAe,CAAlB,EAAqB;AACnBV,WAAGqB,UAAH,CAAc;AACZC,eAAKC,QADO;AAEZ9B,gBAAM2B,IAAI3B,IAFE;AAGZ+B,iBAHY,qBAGD;AACTxB,eAAGyB,YAAH;AACD;AALW,SAAd;AAOD;AACF,KAfD,EAeG,eAAO;AACRzB,SAAGY,SAAH,CAAa,EAAEV,OAAOwB,GAAT,EAAb;AACD,KAjBD;AAkBD;AApEE,CAAL","file":"index.js","sourcesContent":["import user from '../../../model/user';\nlet ctx;\nPage({\n\n  data: {\n    tel: \"\",\n    code: \"\",\n    openid: \"\",\n    unionid: \"\",\n  },\n\n  onLoad (params) {\n    ctx = this;\n    wx.setNavigationBarTitle({title: '绑定手机号'});\n    ctx.setData({\n      openid: params.openid,\n      unionid: params.unionid\n    });\n  },\n\n  // 获取短信验证码\n  getCode () {\n    let tel = ctx.data.tel;\n    console.log(tel);\n    user.getCode({ tel }).then(data => {\n      let showInfo = {\n        title: '提示',\n        icon: 'loading',\n      };\n      if (data.retcode == 0) {\n        showInfo.title = \"发送短信成功\";\n        showInfo.icon = 'success'\n      } else {\n        showInfo.title = data.retinfo;\n      }\n      wx.showToast(showInfo);\n    })\n  },\n\n  telHandler (e) {\n    let value = e.detail.value;\n    this.setData({ tel: value })\n  },\n\n  codeHandler (e) {\n    let value = e.detail.value;\n    this.setData({ code: value })\n  },\n\n  submit () {\n    let data = ctx.data;\n    console.log(data);\n    user.bindTelLogin({\n      tel: data.tel,\n      code: data.code,\n      openid: data.openid,\n      unionid: data.unionid,\n    }).then(res => {\n      if(res.retcode == 0) {\n        wx.setStorage({\n          key: userinfo,\n          data: res.data,\n          success () {\n            wx.navigateBack();\n          }\n        });\n      }\n    }, err => {\n      wx.showToast({ title: err })\n    })\n  }\n});"]}